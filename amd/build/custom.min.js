function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("block_advnotifications/custom",["jquery"],function(a){return{initialise:function initialise(){a(document).ready(function(){var b=a("#region-main"),c=a("#add_notification_wrapper_id"),d={save:"Save",update:"Update",req:"Required...",preview:"Preview",title:"Title",message:"Message"};b.on("click",".notifications_table tr > td > form > button[type=submit]",function(b){b.preventDefault();var c={call:"ajax",purpose:"",tableaction:"",blockid:""},g=a(this).closest("form").attr("data-edit"),j=a(this).closest("form").attr("data-delete");c.blockid=a(this).closest("form").find("[name=blockid]")[0].value;h();if(_typeof(g)!=="undefined"&&!1!==g){c.purpose="edit";c.tableaction=g;var k=a("#add_notification_save");k.addClass("update");k.val(d.update)}else if(_typeof(j)!=="undefined"&&!1!==j){c.purpose="delete";c.tableaction=j}var l=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey;a.post(l,c).fail(function(){console.error("No 'manage' response received.")}).done(function(b){b=JSON.parse(b);if(0<parseInt(b.done,10)){a("#tr"+c.purpose+b.done).closest("tr").fadeOut(250,function(){a(this).remove();i();f()})}else if("edit"===c.purpose){for(var d in b){if(b.hasOwnProperty(d)){if("id"===d){var g=a("#add_notification_form");a("#add_notification_id").remove();g.prepend("<input type=\"hidden\" id=\"add_notification_id\" name=\"id\" value=\""+b[d]+"\"/>");a("#add_notification_purpose").val("update")}var h=a("#add_notification_wrapper_id").find("#add_notification_"+d);if(("enabled"===d||"global"===d||"dismissible"===d||"aicon"===d||"sendnotifications"===d)&&1==b[d]){h.prop("checked",!0)}else if(("enabled"===d||"global"===d||"dismissible"===d||"aicon"===d||"sendnotifications"===d)&&0==b[d]){h.prop("checked",!1)}else{h.val(b[d])}}}e()}})});b.on("click",".notifications_restore_table tr > td > form > button[type=submit]",function(b){b.preventDefault();var c={call:"ajax",purpose:"",tableaction:"",blockid:""},d=a(this).closest("form").attr("data-restore"),e=a(this).closest("form").attr("data-permdelete");c.blockid=a(this).closest("form").find("[name=blockid]")[0].value;if(_typeof(d)!=="undefined"&&!1!==d){c.purpose="restore";c.tableaction=d}else if(_typeof(e)!=="undefined"&&!1!==e){c.purpose="permdelete";c.tableaction=e}var f=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey;a.post(f,c).fail(function(){console.error("No 'restore/permdelete' response received.")}).done(function(b){b=JSON.parse(b);if(0<parseInt(b.done,10)){a("#tr"+c.purpose+b.done).closest("tr").fadeOut(250,function(){a(this).remove()})}})});c.on("click","#add_notification_cancel",function(a){a.preventDefault();i()});b.on("submit","#add_notification_form",function(b){b.preventDefault();var c=a("#add_notification_status"),e=a("#add_notification_form");h();if(!g()){return}c.show();var f=a(this).serialize(),j=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php";a.post(j,f).fail(function(b){console.error("No 'add' response received.");var f=b.responseJSON.error;for(var g in f){if(f.hasOwnProperty(g)){var h=e.find("select[name="+f[g]+"]");h.addClass("requiredfield");a("<strong class=\"requiredfield\"><em>"+d.req+"</em></strong>").insertAfter(h[0].nextSibling)}}c.hide()}).done(function(){c.find(".saving").hide();c.find(".done").show();i();setTimeout(function(){c.fadeOut(function(){c.find(".done").hide();c.find(".saving").show()})},1500);a("#advnotifications_table_wrapper").load("# #advnotifications_table_wrapper > *")})});c.on("input propertychange paste","#add_notification_title, #add_notification_message",function(){e()});a("#add_notification_type").on("change",function(){e()});a("#add_notification_dismissible").on("change",function(){e()});a("#add_notification_aicon").on("change",function(){e()});var e=function(){var b=c.find("#add_notification_title");if(0<b.val().length){c.find(".preview-title")[0].innerHTML=b.val()}else{c.find(".preview-title")[0].innerHTML=d.title}var e=c.find("#add_notification_message");if(0<e.val().length){c.find(".preview-message")[0].innerHTML=e.val()}else{c.find(".preview-message")[0].innerHTML=d.message}var f=a("#add_notification_type").val(),g=a("#add_notification_wrapper_id .preview-alert");g.removeClass("alert-info alert-success alert-danger alert-warning announcement");if("announcement"===f){g.addClass(f);f="info"}if("info"!==f&&"success"!==f&&"warning"!==f&&"danger"!==f){f="info"}g.addClass("alert-"+f);a(".preview-aicon").find("> img").attr("src",M.util.image_url(f,"block_advnotifications"));if(!a("#add_notification_dismissible")[0].checked){a(".preview-alert-dismissible").hide();g.removeClass("dismissible")}else{a(".preview-alert-dismissible").show();g.addClass("dismissible")}if(!a("#add_notification_aicon")[0].checked){a(".preview-aicon").hide();g.removeClass("aicon")}else{a(".preview-aicon").show();g.addClass("aicon")}},f=function(){var b=a("#notification_preview_wrapper"),e="<div id=\"notification_preview_wrapper\"><strong>"+d.preview+"</strong><br><div class=\"alert alert-info preview-alert\"><div class=\"preview-aicon\" style=\"display: none;\"><img src=\""+M.util.image_url("info","block_advnotifications")+"\" /></div><strong class=\"preview-title\">"+d.title+"</strong> <div class=\"preview-message\">"+d.message+"</div> <div class=\"preview-alert-dismissible\" style=\"display: none;\"><strong>&times;</strong></div></div></div>";if(0<b.length){b.remove();a(e).prependTo(a(c))}else{a(e).prependTo(a(c)).hide().slideDown()}},g=function(){var b=a("#add_notification_form select option:selected:disabled");for(var c in b){if(b.hasOwnProperty(c)){if(a(b[c]).prop("disabled")){a(b[c]).closest("select").addClass("requiredfield");a("<strong class=\"requiredfield\"><em>"+d.req+"</em></strong>").insertAfter(a(b[c]).closest("select")[0].nextSibling);return!1}}}return!0},h=function(){a("select.requiredfield").removeClass("requiredfield");a("strong.requiredfield").remove()},i=function(){a("#add_notification_form")[0].reset();h();f();var b=a("#add_notification_save");b.removeClass("update");a("#add_notification_id").remove();a("#add_notification_purpose").val("add");b.val(d.save)};(function init(){var b=M.cfg.wwwroot+"/blocks/advnotifications/pages/process.php?sesskey="+M.cfg.sesskey;a.post(b,{call:"ajax",purpose:"strings"}).fail(function(){console.error("No 'strings' response received.")}).done(function(a){d=a}).always(function(){f()});a("#add_notification_form").append("<input type=\"hidden\" id=\"add_notification_call\" name=\"call\" value=\"ajax\"/>")})()})}}});
//# sourceMappingURL=custom.min.js.map
